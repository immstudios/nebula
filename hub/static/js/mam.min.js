function set_browser_highlight(e){$("#browser-body tr").each(function(){$(this).attr("data-href")==e?$(this).addClass("active"):$(this).removeClass("active")})}function set_browser_draggable(){$("#browser-body tr").draggable({distance:10,helper:"clone",revert:"valid",appendTo:"body",containment:"window",scroll:!1})}function on_update_module(e){var t=e["m"];t!=mam_context["m"]&&(set_browser_highlight(e["f"]),$("#module").on("shown.bs.tab",".detail-tab-switcher",function(e){$(e.target).attr("data-href");mam_switch({t:$(this).attr("data-href")})})),"detail"==t&&e["f"]!=mam_context["f"]&&set_browser_highlight(e["f"])}function on_update_browser(e){e["q"]!=mam_context["q"]&&$("#browser-search-query").val(e["q"]),e["v"]!=mam_context["v"]&&$(".view-switcher").each(function(){$(this).attr("data-href")==e["v"]?($(this).parent().addClass("active"),$("#view-name").html($(this).html())):$(this).parent().removeClass("active")})}function update_browser(e){if(0!==Object.keys(e).length)return $.get("/panel_browser",e)}function update_module(e,t){if(0!==Object.keys(t).length)return $.get("/panel_"+e,t)}function mam_switch(e){var t=URLToArray(window.location.href),a={};for(var r in context_defaults)e[r]?a[r]=e[r]:t[r]?a[r]=t[r]:a[r]=context_defaults[r];console.log("Updating context:",a);var o={};for(var r in a)a[r]!=context_defaults[r]&&a[r]&&(o[r]=a[r]);history.pushState(o,"Nebula","/mam?"+ArrayToURL(o));var n=!1,s={};for(var c in module_params["browser"])r=module_params["browser"][c],a[r]!=mam_context[r]&&(console.log(r,a[r],mam_context[r]),n=!0,s[r]=a[r]);var i=a["m"],m=!1,u={};i!=mam_context["m"]&&(m=!0);for(var c in module_params[i])r=module_params[i][c],u[r]=a[r],-1==no_reload_params.indexOf(r)&&a[r]!=mam_context[r]&&(m=!0);if(!n&&!m)return void(mam_context=a);$.when(update_browser(s),update_module(i,u)).done(function(e,t){n&&(401==e[2]["status"]&&(window.location.href="/"),$("#browser").html(e[0]),on_update_browser(a)),m&&(401==t[2]["status"]&&(window.location.href="/"),$("#module").html(t[0]),on_update_module(a)),mam_context=a})}context_defaults={m:"detail",q:"",v:"",p:1,f:"",t:"m",d:"",w:"",c:""},module_params={browser:["q","v","p"],detail:["f","t"]},no_reload_params=["t"],mam_context={v:0},$(document).ready(function(){var e=!1;$("#dragbar").mousedown(function(t){t.preventDefault(),e=!0;var a=$("#module-wrapper"),r=$("<div>",{id:"ghostbar",css:{height:a.outerHeight(),top:a.offset().top,left:a.offset().left}}).appendTo("body");$(document).mousemove(function(e){r.css("left",e.pageX+2)})}),$(document).mouseup(function(t){e&&($("#browser-wrapper").css("width",t.pageX+2),$("#module-wrapper").css("left",t.pageX+2),$("#ghostbar").remove(),$(document).unbind("mousemove"),e=!1)}),$(".view-switcher").on("click",function(){mam_switch({v:$(this).attr("data-href"),p:1}),event.preventDefault()}),$("#browser").on("click",".page-switcher",function(){mam_switch({p:$(this).attr("data-href")}),event.preventDefault()}),$("#browser-clear-button").on("click",function(e){$("#browser-search-query").val(""),mam_switch({q:$("#browser-search-query").val(),p:1}),e.preventDefault()}),$("#browser-search-query").keypress(function(e){13==e.which&&(mam_switch({q:$("#browser-search-query").val(),p:1}),event.preventDefault())}),$("#browser-search-button").on("click",function(e){mam_switch({q:$("#browser-search-query").val(),p:1}),e.preventDefault()}),$("#browser").on("click","tr[data-href]",function(){"detail"==mam_context["m"]&&(mam_switch({f:$(this).attr("data-href")}),event.preventDefault())}),window.onpopstate=function(e){mam_switch(e.state,!1)},mam_switch({}),console.log("MAM ready!")});